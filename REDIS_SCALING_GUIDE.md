# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é Redis –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è 100+ –∫–ª–∏–µ–Ω—Ç–æ–≤

### üìä –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`redis.conf`):
```conf
# –ü–∞–º—è—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞ –¥–æ 1GB
maxmemory 1gb
maxmemory-policy allkeys-lru
maxmemory-samples 10

# –ú–∞–∫—Å–∏–º—É–º 500 –∫–ª–∏–µ–Ω—Ç–æ–≤
maxclients 500

# –£–≤–µ–ª–∏—á–µ–Ω TCP backlog
tcp-backlog 1024

# –ü–æ–≤—ã—à–µ–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
hz 20
```

#### Docker –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`docker-compose.yml`):
```yaml
sysctls:
  - net.core.somaxconn=2048
  - net.core.netdev_max_backlog=5000
```

#### –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (`redis_service.py`):
```python
max_connections=100  # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 20 –¥–æ 100
```

### üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

#### –ù–æ–≤—ã–µ –ø–æ—Ä–æ–≥–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π:
- **–ö–ª–∏–µ–Ω—Ç—ã**: >100 (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ), >200 (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- **–ü–∞–º—è—Ç—å**: >600MB (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ), >800MB (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- **Hit Rate**: <80% (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **–ö–ª–∏–µ–Ω—Ç—ã**: 50-150 (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)
- **–ü–∞–º—è—Ç—å**: <600MB (60% –æ—Ç –ª–∏–º–∏—Ç–∞)
- **–û–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫**: <2000
- **Hit Rate**: >85%

### üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
docker exec remnawave_bot_redis redis-cli info clients

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
docker exec remnawave_bot_redis redis-cli info stats | grep instantaneous

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
docker exec remnawave_bot_redis redis-cli info memory
```

#### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫:
```bash
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤
echo "* soft nofile 65536" >> /etc/security/limits.conf
echo "* hard nofile 65536" >> /etc/security/limits.conf

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP
echo "net.core.somaxconn = 2048" >> /etc/sysctl.conf
echo "net.core.netdev_max_backlog = 5000" >> /etc/sysctl.conf
sysctl -p
```

### üìä –ì—Ä–∞–¥–∞—Ü–∏—è –Ω–∞–≥—Ä—É–∑–æ–∫

#### üü¢ –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (1-50 –∫–ª–∏–µ–Ω—Ç–æ–≤):
- **–ü–∞–º—è—Ç—å**: 256MB
- **–ö–ª–∏–µ–Ω—Ç—ã**: 50
- **–°–æ–µ–¥–∏–Ω–µ–Ω–∏—è**: 20

#### üü° –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ (50-100 –∫–ª–∏–µ–Ω—Ç–æ–≤):
- **–ü–∞–º—è—Ç—å**: 512MB
- **–ö–ª–∏–µ–Ω—Ç—ã**: 100
- **–°–æ–µ–¥–∏–Ω–µ–Ω–∏—è**: 50

#### üî¥ –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (100+ –∫–ª–∏–µ–Ω—Ç–æ–≤):
- **–ü–∞–º—è—Ç—å**: 1GB
- **–ö–ª–∏–µ–Ω—Ç—ã**: 500
- **–°–æ–µ–¥–∏–Ω–µ–Ω–∏—è**: 100

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞**: <5ms
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: 10,000+ ops/sec
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU**: <50%
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: <80%

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Ä–æ–≥–∏:
- **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞**: >50ms
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: <1000 ops/sec
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU**: >90%
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: >90%

### üö® –ê–ª–µ—Ä—Ç—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
1. **–ö–ª–∏–µ–Ω—Ç—ã >100** - "High client count"
2. **–ü–∞–º—è—Ç—å >600MB** - "High memory usage"
3. **Hit Rate <80%** - "Low cache hit rate"
4. **–û–ø–µ—Ä–∞—Ü–∏–π >2000/sec** - "High operations per second"

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç** –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
2. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏** –ø—Ä–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è—Ö
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å** –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö

### üîÑ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
```yaml
# Docker Compose —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ Redis –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
redis-master:
  image: redis:7-alpine
  command: redis-server --appendonly yes

redis-replica:
  image: redis:7-alpine
  command: redis-server --slaveof redis-master 6379
```

#### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
```yaml
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
deploy:
  resources:
    limits:
      memory: 2G
      cpus: '2.0'
    reservations:
      memory: 1G
      cpus: '1.0'
```

### üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

#### ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
- [ ] –£–≤–µ–ª–∏—á–µ–Ω–∞ –ø–∞–º—è—Ç—å –¥–æ 1GB
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –ø—É–ª –Ω–∞ 100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ—Ä–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

#### ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–ª–µ—Ä—Ç—ã
- [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- [ ] –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- [ ] –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- [ ] Hit Rate >85%
- [ ] –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ <5ms
- [ ] –ö–ª–∏–µ–Ω—Ç–æ–≤ <150
- [ ] –ü–∞–º—è—Ç—å <600MB

### üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
docker exec remnawave_bot_redis redis-cli client list | wc -l

# –ó–∞–∫—Ä—ã—Ç–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
docker exec remnawave_bot_redis redis-cli client kill type normal
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
```bash
# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
docker exec remnawave_bot_redis redis-cli flushall

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ–ª—å—à–∏—Ö –∫–ª—é—á–µ–π
docker exec remnawave_bot_redis redis-cli --bigkeys
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
docker exec remnawave_bot_redis redis-cli slowlog get 10

# –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
docker exec remnawave_bot_redis redis-cli slowlog reset
```

### üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```bash
# –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
docker exec remnawave_bot_redis redis-cli info

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
docker exec remnawave_bot_redis redis-cli info clients

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏
docker exec remnawave_bot_redis redis-cli info memory

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
docker exec remnawave_bot_redis redis-cli info stats
```

#### –ö–æ–Ω—Ç–∞–∫—Ç—ã:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/redis_status` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Redis –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å 100+ –∫–ª–∏–µ–Ω—Ç–∞–º–∏:
- **–ü–∞–º—è—Ç—å**: 1GB (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫)
- **–ö–ª–∏–µ–Ω—Ç—ã**: –¥–æ 500 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 10,000+ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É —Å –≤—ã—Å–æ–∫–∏–º–∏ –Ω–∞–≥—Ä—É–∑–∫–∞–º–∏! üöÄ
